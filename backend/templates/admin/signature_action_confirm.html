{% extends "admin/base_site.html" %}

{% block title %}{{ title }} - Document Signature Verification{% endblock %}

{% block content %}
<div class="content">
    <h1>{{ title }}</h1>
    
    <div class="module" style="margin-bottom: 20px;">
        <h2>Document Details</h2>
        <table style="width: 100%;">
            <tr>
                <th style="text-align: left; padding: 8px;">Title:</th>
                <td style="padding: 8px;">{{ report.title }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 8px;">User:</th>
                <td style="padding: 8px;">{{ report.user.email }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 8px;">Created:</th>
                <td style="padding: 8px;">{{ report.created_at|date:"M d, Y H:i" }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 8px;">Verification Code:</th>
                <td style="padding: 8px;"><code>{{ report.verification_code }}</code></td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 8px;">Submitted for Verification:</th>
                <td style="padding: 8px;">{{ report.signature_submitted_at|date:"M d, Y H:i" }}</td>
            </tr>
            {% if report.qr_code_url %}
            <tr>
                <th style="text-align: left; padding: 8px;">Verification URL:</th>
                <td style="padding: 8px;">
                    <a href="{{ report.qr_code_url }}" target="_blank">{{ report.qr_code_url }}</a>
                </td>
            </tr>
            {% endif %}
        </table>
    </div>

    <form method="post">
        {% csrf_token %}
        
        <div class="module">
            <h2>
                {% if action == 'approve' %}
                    Approve Document Signature
                {% else %}
                    Reject Document Signature
                {% endif %}
            </h2>
            
            <div class="form-group" style="margin: 20px 0;">
                <label for="notes" style="display: block; font-weight: bold; margin-bottom: 5px;">
                    Admin Notes (optional):
                </label>
                <textarea 
                    name="notes" 
                    id="notes" 
                    rows="4" 
                    cols="80"
                    style="width: 100%; padding: 8px; border: 1px solid #ccc;"
                    placeholder="Add any notes about your decision..."></textarea>
            </div>
        </div>

        <div class="submit-row" style="margin-top: 20px;">
            {% if action == 'approve' %}
                <input 
                    type="submit" 
                    value="✓ Approve Signature" 
                    class="default" 
                    style="background: green; color: white; padding: 10px 20px; border: none; cursor: pointer;"
                />
            {% else %}
                <input 
                    type="submit" 
                    value="✗ Reject Signature" 
                    class="deletelink" 
                    style="background: red; color: white; padding: 10px 20px; border: none; cursor: pointer;"
                />
            {% endif %}
            
            <a href="{% url 'admin:reports_incomereport_changelist' %}" 
               class="button" 
               style="margin-left: 10px; padding: 10px 20px; text-decoration: none; background: #f0f0f0; border: 1px solid #ccc;">
                Cancel
            </a>
        </div>
    </form>

    <div class="help" style="margin-top: 30px; padding: 15px; background: #f9f9f9; border-left: 3px solid #007cba;">
        <h3>What happens after {{ action }}?</h3>
        {% if action == 'approve' %}
        <p>✓ The document will be marked as <strong>verified and approved</strong></p>
        <p>✓ The QR code will show "Document Verified" when scanned</p>
        <p>✓ Public verification page will display approval status</p>
        <p>✓ User will receive notification of approval</p>
        {% else %}
        <p>✗ The document will be marked as <strong>rejected</strong></p>
        <p>✗ The QR code will show "Document Not Verified" when scanned</p>
        <p>✗ Public verification page will display rejection status</p>
        <p>✗ User will receive notification of rejection with notes</p>
        {% endif %}
    </div>
</div>
{% endblock %}
